# js线程相关

## javascript是单线程的

### 原因
由于JavaScript中存在对于DOM的操作，所以必须保证JavaScript是单线程的，不然多个线程同时对DOM进行操作时就会产生问题


## Nodejs是单线程的

对于这句话的理解是这样的：

1. nodejs本身不是单线程的，他包含了JavaScript线程以及多个I/O线程
2. nodejs的JavaScript运行环境的单线程的

### 问题：nodejs既然是单线程，如何实现异步、非阻塞I/O？
原因就是只有js执行是单线程，I/O是由其它线程完成的。
js执行线程是单线程，把需要做的I/O交给libuv，自己马上返回做别的事情，然后libuv在指定的时刻回调就行了，这样就保证了异步、非阻塞I/O。

总结来说，一个异步 I/O 的大致流程如下：

1. 发起 I/O 调用
用户通过 Javascript 代码调用 Node 核心模块，将参数和回调函数传入到核心模块；
Node 核心模块会将传入的参数和回调函数封装成一个请求对象；
将这个请求对象推入到 I/O 线程池等待执行；
Javascript 发起的异步调用结束，Javascript 线程继续执行后续操作。

2. 执行回调
I/O 操作完成后，会取出之前封装在请求对象中的回调函数，执行这个回调函数，以完成 Javascript 回调的目的。

### 问题：nodejs全是异步调用和非阻塞I/O，就真的不用管并发数了吗？
之前我们就提到了线程池的概念，发现nodejs并不是单线程的，而且还有并行事件发生。同时，线程池默认大小是 4 ，也就是说，同时能有4个线程去做文件i/o的工作，剩下的请求会被挂起等待直到线程池有空闲。 所以nodejs对于并发数，是由限制的。
线程池的大小可以通过 UV_THREADPOOL_SIZE 这个环境变量来改变 或者在nodejs代码中通过 process.env.UV_THREADPOOL_SIZE来重新设置。
